# ===========================================
# Application
# ===========================================
quarkus.application.name=search-service

# ===========================================
# Server Configuration
# ===========================================
quarkus.http.port=8084
quarkus.http.host=0.0.0.0


# Bind to all interfaces in production
# Production (KTH Cloud)
%prod.quarkus.http.port=${PORT:8084}
%prod.quarkus.http.host=0.0.0.0
# ===========================================
# CORS Configuration
# ===========================================
quarkus.http.cors.enabled=true
quarkus.http.cors.origins=http://localhost:3000,http://localhost:30000,https://patientsystem-frontend.app.cloud.cbh.kth.se
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with,origin,access-control-request-method,access-control-request-headers
quarkus.http.cors.exposed-headers=location,info
quarkus.http.cors.access-control-allow-credentials=true
quarkus.http.cors.access-control-max-age=24H

%prod.quarkus.http.cors.enabled=true
%prod.quarkus.http.cors.origins=http://localhost:3000,http://localhost:30000,https://patientsystem-frontend.app.cloud.cbh.kth.se
%prod.quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
%prod.quarkus.http.cors.headers=*
%prod.quarkus.http.cors.access-control-allow-credentials=true

# ===========================================
# FHIR Server REST Client Configuration
# ===========================================
quarkus.rest-client.fhir-api.url=https://hapi-fhir.app.cloud.cbh.kth.se/fhir
%prod.quarkus.rest-client.fhir-api.url=${FHIR_SERVER_URL:https://hapi-fhir.app.cloud.cbh.kth.se/fhir}

# ===========================================
# OIDC Configuration (Keycloak)
# ===========================================
quarkus.oidc.auth-server-url=https://patientsystem-keycloak.app.cloud.cbh.kth.se/realms/patientsystem
%prod.quarkus.oidc.auth-server-url=${KEYCLOAK_AUTH_SERVER_URL:https://patientsystem-keycloak.app.cloud.cbh.kth.se/realms/patientsystem}

# Client ID (must match Keycloak client)
quarkus.oidc.client-id=patientsystem

# This is a service (bearer token only, no login flow)
quarkus.oidc.application-type=service

# Role extraction from Keycloak token
quarkus.oidc.roles.role-claim-path=realm_access/roles

# TLS certificate verification (disable for self-signed certs in dev/test)
quarkus.tls.trust-all=true
%prod.quarkus.tls.trust-all=true
# ===========================================
# Security Policy
# ===========================================
# CORS preflight requests (OPTIONS) must be permitted without auth
quarkus.http.auth.permission.cors.paths=/api/*
quarkus.http.auth.permission.cors.methods=OPTIONS
quarkus.http.auth.permission.cors.policy=permit

%prod.quarkus.http.auth.permission.cors.paths=/api/*
%prod.quarkus.http.auth.permission.cors.methods=OPTIONS
%prod.quarkus.http.auth.permission.cors.policy=permit

# Require authentication for all /api/* endpoints (except OPTIONS)
quarkus.http.auth.permission.authenticated.paths=/api/*
quarkus.http.auth.permission.authenticated.methods=GET,POST,PUT,DELETE,PATCH
quarkus.http.auth.permission.authenticated.policy=authenticated

%prod.quarkus.http.auth.permission.authenticated.paths=/api/*
%prod.quarkus.http.auth.permission.authenticated.methods=GET,POST,PUT,DELETE,PATCH
%prod.quarkus.http.auth.permission.authenticated.policy=authenticated

# Health endpoints are public
quarkus.http.auth.permission.health.paths=/q/health/*,/q/health/live,/q/health/ready
quarkus.http.auth.permission.health.policy=permit

%prod.quarkus.http.auth.permission.health.paths=/q/health/*,/q/health/live,/q/health/ready
%prod.quarkus.http.auth.permission.health.policy=permit

# Root and hello endpoints are public
quarkus.http.auth.permission.public.paths=/,/api/search/hello
quarkus.http.auth.permission.public.policy=permit

%prod.quarkus.http.auth.permission.public.paths=/,/api/search/hello
%prod.quarkus.http.auth.permission.public.policy=permit

# ===========================================
# Logging
# ===========================================
quarkus.log.console.level=INFO
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n
quarkus.log.category."org.journalsystem".level=DEBUG
quarkus.log.category."io.quarkus.oidc".level=DEBUG

%prod.quarkus.log.category."org.journalsystem".level=INFO
%prod.quarkus.log.category."io.quarkus.oidc".level=WARN