# Application
quarkus.application.name=search-service

# ===========================================
# Server Configuration
# ===========================================
# Local development
quarkus.http.port=8084
quarkus.http.host=0.0.0.0

# Production (KTH Cloud)
%prod.quarkus.http.port=${PORT:8084}
%prod.quarkus.http.host=0.0.0.0

# ===========================================
# CORS Configuration
# ===========================================
quarkus.http.cors.enabled=true
quarkus.http.cors.origins=http://localhost:3000,http://localhost:30000,https://patientsystem-frontend.app.cloud.cbh.kth.se
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=accept,authorization,content-type,x-requested-with,origin,access-control-request-method,access-control-request-headers
quarkus.http.cors.exposed-headers=location,info
quarkus.http.cors.access-control-allow-credentials=true
quarkus.http.cors.access-control-max-age=24H

# ===========================================
# FHIR Server REST Client Configuration
# ===========================================
quarkus.rest-client.fhir-api.url=https://hapi-fhir.app.cloud.cbh.kth.se/fhir
quarkus.rest-client.fhir-api.scope=jakarta.inject.Singleton

%prod.quarkus.rest-client.fhir-api.url=${FHIR_SERVER_URL:https://hapi-fhir.app.cloud.cbh.kth.se/fhir}

# ===========================================
# OIDC Configuration (Keycloak)
# ===========================================
# Auth server URL
quarkus.oidc.auth-server-url=https://patientsystem-keycloak.app.cloud.cbh.kth.se/realms/patientsystem
%prod.quarkus.oidc.auth-server-url=${KEYCLOAK_AUTH_SERVER_URL:https://patientsystem-keycloak.app.cloud.cbh.kth.se/realms/patientsystem}

# Client ID (must match Keycloak client)
quarkus.oidc.client-id=patientsystem

# This is a service (bearer token only, no login flow)
quarkus.oidc.application-type=service

# Role extraction from Keycloak token
quarkus.oidc.roles.role-claim-path=realm_access/roles

# TLS certificate verification (disable for self-signed certs)
quarkus.oidc.tls.verification=none
%prod.quarkus.oidc.tls.verification=none

# ===========================================
# Security Policy
# ===========================================
# Require authentication for all /api/* endpoints by default
quarkus.http.auth.permission.authenticated.paths=/api/*
quarkus.http.auth.permission.authenticated.policy=authenticated

# Health endpoint is public
quarkus.http.auth.permission.health.paths=/q/health/*,/q/health/live,/q/health/ready
quarkus.http.auth.permission.health.policy=permit

# Root endpoint is public
quarkus.http.auth.permission.public.paths=/
quarkus.http.auth.permission.public.policy=permit

# ===========================================
# Logging (for debugging)
# ===========================================
quarkus.log.category."org.journalsystem".level=DEBUG
quarkus.log.category."io.quarkus.oidc".level=DEBUG
%prod.quarkus.log.category."org.journalsystem".level=INFO
%prod.quarkus.log.category."io.quarkus.oidc".level=WARN