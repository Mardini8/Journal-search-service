# Application
quarkus.application.name=search-service

# ===========================================
# Server Configuration
# ===========================================
# Local development
quarkus.http.port=8084
quarkus.http.host=0.0.0.0

# Production (KTH Cloud)
%prod.quarkus.http.port=${PORT:8084}
%prod.quarkus.http.host=0.0.0.0

# ===========================================
# CORS Configuration
# ===========================================
quarkus.http.cors=true
quarkus.http.cors.origins=http://localhost:3000,http://localhost:30000,https://patientsystem-frontend.app.cloud.cbh.kth.se
quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors.headers=*
quarkus.http.cors.access-control-allow-credentials=true

%prod.quarkus.http.cors=true
%prod.quarkus.http.cors.origins=http://localhost:3000,http://localhost:30000,https://patientsystem-frontend.app.cloud.cbh.kth.se
%prod.quarkus.http.cors.methods=GET,POST,PUT,DELETE,OPTIONS
%prod.quarkus.http.cors.headers=*
%prod.quarkus.http.cors.access-control-allow-credentials=true

# ===========================================
# FHIR Server
# ===========================================
fhir.server.url=https://hapi-fhir.app.cloud.cbh.kth.se/fhir
%prod.fhir.server.url=${FHIR_SERVER_URL:https://hapi-fhir.app.cloud.cbh.kth.se/fhir}

# ===========================================
# OIDC Configuration (Keycloak)
# ===========================================
# Auth server URL
quarkus.oidc.auth-server-url=https://patientsystem-keycloak.app.cloud.cbh.kth.se/realms/patientsystem
%prod.quarkus.oidc.auth-server-url=${KEYCLOAK_AUTH_SERVER_URL:https://patientsystem-keycloak.app.cloud.cbh.kth.se/realms/patientsystem}

# Client ID (must match Keycloak client)
quarkus.oidc.client-id=patientsystem

# This is a service (bearer token only, no login flow)
quarkus.oidc.application-type=service

# Role extraction from Keycloak token
quarkus.oidc.roles.role-claim-path=realm_access/roles

# TLS certificate verification (enable in production)
quarkus.oidc.tls.verification=none
%prod.quarkus.oidc.tls.verification=none

# ===========================================
# Security Policy
# ===========================================
# Require authentication for all /api/* endpoints by default
quarkus.http.auth.permission.authenticated.paths=/api/*
quarkus.http.auth.permission.authenticated.policy=authenticated

# Health endpoint is public
quarkus.http.auth.permission.health.paths=/q/health/*
quarkus.http.auth.permission.health.policy=permit